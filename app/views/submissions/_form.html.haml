#submit_form
  = form_for @submission do |f|
    -if @submission.errors.any?
      #error_explanation
        %h2= "#{pluralize(@submission.errors.count, "error")} prohibited this submission from being saved:"
        %ul
          - @submission.errors.full_messages.each do |msg|
            %li= msg

    .field
      = f.text_field :headline, :placeholder => "Headline"
    .field
      = f.text_field :byline, :placeholder => "Byline"
    .field
      = f.hidden_field :body

      %div{:id => 'editor' }
        %div{:id => 'submission_body_editable_wrapper'}
          %div{:id => 'submission_body_editable', :class => 'editable'}
            %p

    .actions
      = f.submit 'Save', :id => "submission_save"
      
    %ul#ice_actions
      %li
        %a{:id => "toggle_changes"} Show/Hide Changes
      %li
        %a{:id => "accept_all"} Accept all changes
      %li
        %a{:id => "reject_all"} Reject all changes
      %li
        %a{:id => "accept_change"} Accept change
      %li
        %a{:id => "reject_change"} Reject change


  :javascript
    $(function() {
        var text = document.getElementById('submission_body_editable');
        window.tracker = new ice.InlineChangeEditor({
            element: text,
            handleEvents: true,
            plugins : ['IceAddTitlePlugin', 'IceSmartQuotesPlugin', 'IceEmdashPlugin', {
                name : 'IceCopyPastePlugin',
                settings : {
                    pasteType : 'formattedClean',
                    preserve : 'p,a[href],i,em,b,strong,span[id,class]'
                }
            }]
        }).startTracking();
    });
    jQuery(document).ready(function() {
      tracker.setCurrentUser({
        id: "#{current_editor.id}",
        name: "#{current_editor.name}"
      });
      jQuery("#accept_all").mousedown(function() {
        return tracker.acceptAll();
      });
      jQuery("#reject_all").mousedown(function() {
        return tracker.rejectAll();
      });
      jQuery("#accept_change").mousedown(function() {
        return tracker.acceptChange();
      });
      jQuery("#reject_change").mousedown(function() {
        return tracker.rejectChange();
      });
    });
